define(["jquery","underscore","backbone","collections/oa","views/base","models/generic"],function(e,t,n,r,i,s){var o=i.extend({el:e("#page_container"),collection_loaded:!1,initialize:function(){var t="<div id='page'>";t+="<div id='body_container'>",t+="</div>",t+="</div>",this.$el.html(t),sessionStorage.getItem("OpenAccessArticleList")==null?this.collection_loaded=!1:this.collection_loaded=!0,this.collection_loaded==0&&(this.collection=new r,this.collection.bind("add",this.modelBind),this.collection.bind("reset",this.render,this),this.collection.bind("change",this.change,this),this.collection.fetch(),collection_loaded=!0,t="<div id='view_preloader_container'>",t+="<img src='"+this.globalModel.getEnvironment()+"images/preloader.gif' />",t+="</div>",e("#body_container").html(t));var n=this;this.collection_loaded==1&&(e("#view_preloader_container").fadeOut("slow"),setTimeout(function(){n.render()},250))},change:function(){},modelBind:function(e){},render:function(){e("#view_preloader_container").remove();if(this.collection_loaded==1){var t=sessionStorage.getItem("OpenAccessArticleList");t=JSON.parse(t),this.collection=new r;for(j=0;j<t.length;j++){var n=new s;n=t[j],this.collection.add(n)}}else{var i=this.collection.toJSON();i.length>0&&sessionStorage.getItem("OpenAccessArticleList")==null&&sessionStorage.setItem("OpenAccessArticleList",JSON.stringify(i))}var o="",u=0;for(var a=0;a<this.collection.models.length;++a){var f=this.collection.models[a];f.get("IssueCitationText")!=this.lastCitationText&&(o+="<div id='section_title_header_container'>",o+="<div id='section_title_header_label'>"+f.get("IssueCitationText"),o+="</div>",o+="</div> "),o+="<div id='article_container_"+a+"' class='article_container'>",o+="<div id='thumb_container'>",f.get("ArticleImageUrl")&&(o+="<img src='"+f.get("ArticleImageUrl")+"' />"),o+="</div>",o+="<div id='article_details_container'>",o+="<div id='article_title'>"+f.get("Title").truncate(),o+="</div>",o+="<div id='author_label'>"+f.get("Authors"),o+="</div>",o+="<div id='article_links_container'>",f.get("IsCME")==1&&(o+="<div id='article_links_button'>",o+="<img src='"+this.globalModel.getEnvironment()+"images/icon-cme.jpg' />",o+="</div>"),f.get("IsOpenAccess")==1&&(o+="<div id='article_links_button'>",o+="<img src='"+this.globalModel.getEnvironment()+"images/icon-open.gif' />",o+="</div>"),f.get("IsPAP")==1&&(o+="<div id='article_links_button'>",o+="<img src='"+this.globalModel.getEnvironment()+"'images/icon-indicator-pap.png' />",o+="</div>"),f.get("IsSDC")==1&&(o+="<div id='article_links_button'>",o+="<img src='"+this.globalModel.getEnvironment()+"images/icon-sdc.gif'>",o+="</div>"),o+="</div>",o+="<div class='clearfix'>&nbsp;</div>",o+="</div>",o+="</div> ",this.lastCitationText=f.get("IssueCitationText");if(a<this.collection.models.length-1){u++;var l=this.collection.models[u].get("IssueCitationText");l==this.lastCitationText&&(o+="<hr>")}}e("#body_container").append(o);for(var a=0;a<this.collection.models.length;a++){f=this.collection.models[a];var c=this.collection;e("#article_container_"+a).click(function(t){if(t.target.id!=="section_title_header_label"&&t.target.id!=="section_title_header_container"){e("#body_container").remove();var n=this.id;n=n.substr(n.lastIndexOf("_")+1,n.length),window.location="#/full_article/?articleAccessionNumber="+c.models[n].get("ArticleAccessionNumber")+"&list=OpenAccessArticleList&index="+n}})}}});return o});