define(["jquery","jquerymove","jqueryswipe","underscore","backbone","views/base","models/global","fullText","toolTip","imageWrapperControl","views/signin/main","swipeview"],function(e,t,n,r,s,o,u,a,f,l,c,h){var p=o.extend({el:e("#page_container"),initialize:function(){this.eventAggregator.bind("loginStateChange",this.onDPSLoaded);var e="<div class='horizontalPageContainer' id='horizontalPageContainer'>";e+="<div id='wrapper'>",e+="<div id='content' class='img_slides_wrap slides_wrap wrap'>",e+="<div id='view_preloader_container' style='margin-left: 10px;margin-top: 10px;'>",e+="<img src='"+this.globalModel.getEnvironment()+"images/preloader.gif' />",e+="</div>",e+="</div>",e+="</div>",e+="</div>",this.$el.html(e)},render:function(){e("#view_preloader_container").remove();var t={},n=window.location.href,r=n.split("&");for(var i=0;i<r.length;i++){var s=r[i].split("=");if(typeof t[s[0]]=="undefined")t[s[0]]=s[1];else if(typeof t[s[0]]=="string"){var o=[t[s[0]],s[1]];t[s[0]]=o}else t[s[0]].push(s[1])}list=t.list,index=t.index;var u=sessionStorage.getItem(list);u=JSON.parse(u),articles=u;var a,f,i,l,c=index==0?articles.length-1:index-1,h=document.querySelectorAll("#nav li"),p=articles;e("#wrapper").on("next",function(){c==articles.length-1?c=0:c++}),e("#wrapper").on("prev",function(){c<=1?c=articles.length:c--}),a=new SwipeView("#wrapper",{numberOfPages:p.length});for(i=0;i<3;i++)f=document.createElement("div"),f.id="page_"+i,f.className="page",f.innerHTML=this.getPageMarkUp(c,this),a.masterPages[i].appendChild(f),this.bindAssets(c,this,articles),c==articles.length-1?c=0:c++;var d=this;a.onFlip(function(){var e,t,n;for(n=0;n<3;n++){t=a.masterPages[n].dataset.upcomingPageIndex;var r=Number(t)+1;t!=a.masterPages[n].dataset.pageIndex&&(e=a.masterPages[n].querySelector("div"),e.innerHTML=d.getPageMarkUp(c,d,articles),d.bindAssets(c,d,articles))}}),a.onMoveOut(function(){a.masterPages[a.currentMasterPage].className=a.masterPages[a.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"")}),a.onMoveIn(function(){var e=a.masterPages[a.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(e)||(a.masterPages[a.currentMasterPage].className=e?e+" swipeview-active":"swipeview-active")})},getPageMarkUp:function(e,t){var n="<b>Abstract:</b>",r=articles[e].Abstract.replace("<![CDATA[","");r=r.replace("]]>","");var i;r.length>0?(r=r.replace("Introduction:","<br/>Introduction:"),r=r.replace("Background:","<br/>Background:"),r=r.replace("Methods:","<br/><br/>Methods:"),r=r.replace("Results:","<br/><br/>Results:"),r=r.replace("Conclusions:","<br/><br/>Conclusions:"),i=n+r):i="An abstract is unavailable";var s=articles[e].FormattedAuthors;s=s.split(";");var o;s.length>3?o="<a style='color: #5a5a5a;text-decoration: none;' onclick=\"javascript:showReference(this, '"+articles[e].UnFormattedAuthors+"')\">"+articles[e].FormattedAuthors+"</a>":o=articles[e].FormattedAuthors;var u="<div id='section_title_header_container'>";return u+="<div id='section_title_header_label'>",u+=articles[e].Section,u+="</div>",u+="</div>",u+="<div id='issue_container'>",u+="<div id='issue_image_"+e+"' class='issue_image'>",u+="</div>",u+="<div id='issue_details_container'>",u+="<div id='issue_title'>",u+=articles[e].Title.truncate(),u+="</div>",u+="<div id='author_label'>"+o+"</div>",articles[e].IsCME==1&&(u+="<div id='article_links_button'>",u+="<img src='"+t.globalModel.getEnvironment()+"images/icon-cme.jpg' />",u+="</div>"),articles[e].IsOpenAccess==1&&(u+="<div id='article_links_button'>",u+="<img src='"+t.globalModel.getEnvironment()+"images/icon-open.gif' />",u+="</div>"),articles[e].IsPAP&&(u+="<div id='article_links_button'>",u+="<img src='"+t.globalModel.getEnvironment()+"'images/icon-indicator-pap.png' />",u+="</div>"),articles[e].IsSDC==1&&(u+="<div id='article_links_button'>",u+="<img src='"+t.globalModel.getEnvironment()+"images/icon-sdc.gif'>",u+="</div>"),u+="</div>",u+="<div class='clearfix'>&nbsp;</div>",u+="</div>",u+="</div>",u+="<div class='clearfix'>&nbsp;</div>",u+="<div id='article_detail_container'>",u+="<div class='verticalScrollContainer' id='verticalScrollContainer_"+e+"' style='height:425px;'>",u+="<div id='content_"+e+"'>"+i+"</div>",u+="</div>",u+="</div>",u+="<div class='clearfix'>&nbsp;</div>",u+="<div id='issue_purchase_container'>",u+="<div id='citation_label_"+e+"' class='citation_label'>",u+=articles[e].IssueCitationText,u+="</div>",u+="<div id='price_label_"+e+"' class='price_label'>",u+="</div>",u+="<div id='buy_issue_button' class='buy_issue_button_"+e+"'>",u+="</div>",u+="<div id='login_container' class='login_container_"+e+"'>",u+="<div id='login_button_or'>",u+="or",u+="</div>",u+="<div id='login_button_"+e+"' class='login_button'>",u+="Sign In",u+="</div>",u+="</div>",u+="<div id='stateDebug_"+e+"'>",u+="</div>",u+="</div>",u+="</div>",u+="</div>",u},bindAssets:function(t,n,r){function o(){adobe.dps.store.getFolioData(u)}function u(n){storeFolios=n;var r=e("#citation_label_"+t),i=e("#price_label_"+t),o=s[t].ArticleAccessionNumber.replace(/-/gi,""),u=o.substr(0,o.length-5);u+="00000";var f=0,l=0,c=[],h=!1;for(var p=0;p<storeFolios.length;p++)c.push(storeFolios[p].productId),storeFolios[p].productId==u&&(h=!0,f=storeFolios[p].state,l=storeFolios[p].price);var d=e("#stateDebug_"+t);i.html(l),r.html(s[t].IssueCitationText),makeSmartButton(f,e(".buy_issue_button_"+t),e(".buy_issue_button_"+t),u),adobe.dps.store.getUserInfo(a),h!=1&&(e(".buy_issue_button_"+t).hide(),i.hide(),e(".login_container_"+t).hide())}function a(n){var r=n,s=r.authToken,o=r.userName,u=e(".login_container_"+t);if(s==null||s.length==0){for(i=0;i<3;i++)e(".login_container_"+i).fadeIn("slow");e("#login_button_"+t).click(function(){e("#container").append("<div id='dialog'></div>"),this.loginView=new c,this.loginView.setElement("#dialog").render()})}else for(i=0;i<3;i++)e(".login_container_"+i).fadeOut("slow")}var s=r;e(".login_container_"+t).hide(),e("#issue_image_"+t).html('<img src="'+s[t].ArticleImageUrl+'" />'),e(window).onadobedpscontextloaded=o()},removeInstance:function(){}});return p});