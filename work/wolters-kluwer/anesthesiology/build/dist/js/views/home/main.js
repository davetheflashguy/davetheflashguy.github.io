define(["jquery","underscore","backbone","collections/home","views/home/footer","views/base","views/signin/main","models/generic","jqueryfastclick"],function(e,t,n,r,i,s,o,u,a){var f=s.extend({el:e("#page_container"),jquery_speed:"slow",collection_loaded:!1,gscope:null,renderCount:0,version:"1.1.9",initialize:function(){window.addEventListener("load",function(){new FastClick(document.body)},!1),window.addEventListener("offline",function(e){promptNetworkChange(!1)}),window.addEventListener("online",function(e){promptNetworkChange(!0)}),this.loadCSS(["ui-darkness/jquery-ui-1.9.2.custom"]),this.eventAggregator.bind("loginStateChange",this.onDPSLoaded),sessionStorage.getItem("HomeCollection")==null?this.collection_loaded=!1:this.collection_loaded=!0,this.collection_loaded==0&&(this.collection=new r,this.collection.bind("add",this.modelBind),this.collection.bind("reset",this.render,this),this.collection.bind("change",this.change,this),this.collection.fetch(),collection_loaded=!0),gscope=this.globalModel;var t="<div id='optional_image'>";t+="</div>",t+="<div id='body_container'>",t+="<div id='view_preloader_container'>",t+="<img src='"+this.globalModel.getEnvironment()+"images/preloader.gif' />",t+="</div>",t+="</div>",t+="<div id='footer_container'>",t+="</div>",this.$el.html(t),e("#login_container").hide(),this.footerView=new i,this.footerView.setElement("#footer_container").render();if(this.collection_loaded==1){var n=sessionStorage.getItem("HomeCollection");n=JSON.parse(n);var s="<img src ='"+n[0].currentIssueObj.CoverURL+"' />";e("#issue_image").html(s),e("#issue_information").text(n[0].currentIssueObj.IssueCitiationText),e("#issue_summary").text(n[0].Description),e("#toc_container").click(function(){window.location="#/table_of_contents"}),this.collection=new r;var o=new u;o=n,this.collection.add(o),this.updateView()}},change:function(){},modelBind:function(e){},render:function(){if(sessionStorage.getItem("HomeCollection")==null){var t=this.collection.toJSON();t.length>0&&sessionStorage.setItem("HomeCollection",JSON.stringify(t))}this.renderCount++;if(this.renderCount>=2){var n=this;e("#view_preloader_container").fadeOut("slow",function(){n.updateView()})}},updateView:function(){var t="<div id='issue_image'></div>";t+="<div id='issue_details_container'>",t+="<div id='issue_information'></div>",t+="<div id='buy_issue_price_tag'></div>",t+="<div id='login_container'>",t+="<div id='login_button_or'>or</div>",t+="<div id='login_button'>Sign In</div>",t+="</div>",t+="<div id='buy_issue_button'></div>",t+="<div id='issue_summary'>",t+="</div>",t+="<div id='toc_container'>Table of Contents</div>",t+="</div>",t+="</div>",t+="<div id='version_container' style='margin-left: 15px;'><small>Version "+this.version+"</small></div>",e("#body_container").html(t),e("#login_container").hide();var n=this.collection.models[0],r=n.get("currentIssueObj");gscope.setCurrentArticle(r);var i="<img src ='"+r.CoverURL+"' />";e("#issue_image").html(i),e("#issue_information").text(r.IssueCitiationText),e("#issue_summary").text(n.get("Description")),e("#toc_container").click(function(){window.location="#/table_of_contents"}),e(window).onadobedpscontextloaded=this.onDPSLoaded()},onDPSLoaded:function(){adobe.dps.store.getUserInfo(userInfoLoaded),adobe.dps.store.getFolioData(folioDataLoaded)}},userInfoLoaded=function(t){var n=t,r=n.authToken,i=n.userName;r==null||r.length==0?(e("#login_container").fadeIn(e(this).jquery_speed),e("#login_button").click(function(){promptLogin()})):e("#login_container").fadeOut(e(this).jquery_speed)},folioDataLoaded=function(t){var n=!1,r=gscope.getCurrentArticle().IssueAccessionNumber.replace(/-/gi,"");for(folio in t)if(t[folio].productId==r){n=!0,sessionStorage.setItem("state",t[folio].state),sessionStorage.setItem("price",t[folio].price);var i=t[folio].price;e("#buy_issue_price_tag").html(i);var s=t[folio].state;makeSmartButton(s,e("#buy_issue_button"),e("#buy_issue_button"),r);var o=[100,200,400,401,1e3,1500];for(var u=0;u<=o.length;u++)s==o[u]&&e("#issue_image").click(function(){adobe.dps.store.viewFolio(r)})}n!=1&&(e("#buy_issue_button").hide(),e("#buy_issue_price_tag").hide(),e("#login_container").hide())},promptLogin=function(){e("#container").append("<div id='dialog_container'></div>"),this.loginView=new o,this.loginView.setElement("#dialog_container").render()});return f});