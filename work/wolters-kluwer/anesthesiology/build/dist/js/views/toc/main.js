define(["jquery","underscore","backbone","collections/toc","views/base","views/signin/main","models/generic"],function(e,t,n,r,i,s,o){var u=i.extend({el:e("#page_container"),jquery_speed:"slow",collection_loaded:!1,gscope:null,initialize:function(){var t="<div id='issue_container'>";t+="<div id='issue_image'><img src='"+this.globalModel.getCurrentArticle().CoverURL+"' /></div>",t+="<div id='issue_details_container'>",t+="<div id='issue_title'>"+this.globalModel.getCurrentArticle().IssueCitiationText+"</div>",t+="<div id='buy_issue_price_tag'></div>",t+="<div id='login_container'>",t+="<div id='login_button_or'>or</div>",t+="<div id='login_button'>Sign In</div>",t+="</div>",t+="<div id='buy_issue_button'></div>",t+="</div>",t+="<div>",t+="</div>",t+="</div>",t+="<div class='clearfix'>&nbsp;</div>",t+="<div id='page'>",t+="<div id='body_container'>",t+="</div>",t+="</div>",this.$el.html(t),this.eventAggregator.bind("loginStateChange",this.onDPSLoaded),sessionStorage.getItem("TOCArticleList")==null?this.collection_loaded=!1:this.collection_loaded=!0,this.collection_loaded==0&&(this.collection=new r,this.collection.bind("add",this.modelBind),this.collection.bind("reset",this.render,this),this.collection.fetch(),t="<div id='view_preloader_container' style='margin-left: 10px;margin-top: 10px;'>",t+="<img src='"+this.globalModel.getEnvironment()+"images/preloader.gif' />",t+="</div>",e("#body_container").html(t)),e("#login_container").hide();var n=this;this.collection_loaded==1&&(e("#view_preloader_container").fadeOut("slow"),setTimeout(function(){n.render()},250)),e(window).onadobedpscontextloaded=this.onDPSLoadedFolioData(),e(window).onadobedpscontextloaded=this.onDPSLoadedUserInfo()},modelBind:function(e){},render:function(){e("#view_preloader_container").remove();if(this.collection_loaded==1){var t=sessionStorage.getItem("TOCArticleList");t=JSON.parse(t),this.collection=new r;for(j=0;j<t.length;j++){var n=new o;n=t[j],this.collection.add(n)}}else{var i=this.collection.toJSON();i.length>0&&sessionStorage.getItem("TOCArticleList")==null&&sessionStorage.setItem("TOCArticleList",JSON.stringify(i))}var s=0,u,a,f="";for(var l=0;l<this.collection.models.length;l++){var c=this.collection.models[l];c.get("Section")!=u&&(f+="<div id='section_title_header_container'>",f+="<div id='section_title_header_label'>"+c.get("Section")+"</div>",f+="</div>"),f+="<div id='article_container_"+l+"' class = 'article_container'>",f+="<div id='section_title'>",f+=c.get("Title").truncate()+"<br/>",f+="</div>",f+="<div id = 'author_label'>"+c.get("FormattedAuthors")+"</div>",f+="<div id='article_links_container'>",c.get("IsCME")==1&&(f+="<div id='article_links_button'>",f+="<img src='"+this.globalModel.getEnvironment()+"images/icon-cme.jpg' />",f+="</div>"),c.get("IsOpenAccess")==1&&(f+="<div id='article_links_button'>",f+="<img src='"+this.globalModel.getEnvironment()+"images/icon-open.gif' />",f+="</div>"),c.get("IsPAP")==1&&(f+="<div id='article_links_button'>",f+="<img src='"+this.globalModel.getEnvironment()+"'images/icon-indicator-pap.png' />",f+="</div>"),c.get("IsSDC")==1&&(f+="<div id='article_links_button'>",f+="<img src='"+this.globalModel.getEnvironment()+"images/icon-sdc.gif'>",f+="</div>"),f+="</div>",f+="<div class='clearfix'>&nbsp;</div>",f+="</div>",u=c.get("Section");if(l<this.collection.models.length-1){s++;var a=this.collection.models[s].get("Section");a==u&&(f+="<hr>")}}e("#body_container").append(f);for(var l=0;l<=this.collection.models.length;l++)e("#article_container_"+l).click(function(){var e=this.id,t=this.id;t=t.substr(t.lastIndexOf("_")+1,t.length),sessionStorage.setItem("selected_article",t),sessionStorage.setItem("selected_section",c.get("Section")),window.location="#/article_abstract/?articleAccessionNumber="+c.get("ArticleAccessionNumber")+"&list=TOCArticleList&index="+t})},onDPSLoadedUserInfo:function(){adobe.dps.store.getUserInfo(userInfoLoaded)},onDPSLoadedFolioData:function(){adobe.dps.store.getFolioData(folioDataLoaded)}},userInfoLoaded=function(t){var n=t,r=n.authToken,i=n.userName;r==null||r.length==0?(e("#login_container").fadeIn(e(this).jquery_speed),e("#login_button").click(function(){promptLogin()})):e("#login_container").fadeOut(e(this).jquery_speed)},folioDataLoaded=function(t){var n=!1,r=gscope.getCurrentArticle().IssueAccessionNumber.replace(/-/gi,"");for(folio in t){n=!0;if(t[folio].productId==r){sessionStorage.setItem("state",t[folio].state),sessionStorage.setItem("price",t[folio].price);var i=t[folio].price;e("#buy_issue_price_tag").html(i);var s=t[folio].state;makeSmartButton(s,e("#buy_issue_button"),e("#buy_issue_button"),r)}}n!=1&&(e("#buy_issue_button").hide(),e("#buy_issue_price_tag").hide(),e("#login_container").hide())},promptLogin=function(){e("#container").append("<div id='dialog_container'></div>"),this.loginView=new s,this.loginView.setElement("#dialog_container").render()});return u});